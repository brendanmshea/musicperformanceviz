<?xml version="1.0" encoding="utf-8"?>
<!-- Adapted from http://www.objectsatellite.com/html/FlexSolutions/MultiCheckBoxWindow/MultiCheckBoxWindowDemo.html -->
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" title="Please select" modalTransparencyBlur="0">
	<mx:Script>
        <![CDATA[
        	import mx.containers.Canvas;       
            import mx.managers.PopUpManager;
            import mx.controls.Label;
            import mx.controls.Text;
            import mx.core.Application;
            import mx.core.Repeater;
            import mx.collections.ArrayCollection;                        
                 
            // A reference to the TextInput control in which to put the result.
            //public var selections:Text;
            
            [Bindable]
            public var dataProvider:ArrayCollection;

			public var callbackOnInitialize:Function;
			public var callbackOnRecord:Function;
			public var callbackOnComplete:Function;
			public var itemColor:Function;
			public var canvas:Canvas;

             private function recordSelections(clearSelections:Boolean, allSelections:Boolean):void
             {
             	callbackOnInitialize();
             	// Erase the current labels.
             	canvas.removeAllChildren();
                //selections.text = "";

                var yCurrent:int = 0;
                var childIndex:int = 100;
                for (var i:int = 0; i < rpCheckBox.length; i++) {
              
                      // We dynamically add a "selected" property 
                      // to the autoAccessories dataProvider.
                      if (clearSelections)  {
                         dataProvider[i].selected = false;
                         callbackOnRecord(rpCheckBox[i].data, false);
                      } else {
                      	 if (allSelections) {
                      	 	rpCheckBox[i].selected = true;
                      	 }
                         dataProvider[i].selected = rpCheckBox[i].selected;
                         if (rpCheckBox[i].selected) {
                         	var label:Label = new Label();
                         	label.text = rpCheckBox[i].label;
                         	label.setStyle("color", itemColor(rpCheckBox[i].label));
							label.setStyle("fontSize", 11);
							label.x = 0;
							label.y = yCurrent;
							canvas.addChild(label);
							yCurrent += 12;
							childIndex ++;
                         }
                         callbackOnRecord(rpCheckBox[i].data, rpCheckBox[i].selected);
                      }
                 }
                PopUpManager.removePopUp(this);
                callbackOnComplete();                
             }
 
        ]]>
    </mx:Script>

    <mx:VBox borderStyle="inset" 
             horizontalGap="10" verticalGap="5"
             paddingLeft="10" paddingTop="10"
             paddingBottom="10" paddingRight="10" 
             maxHeight="300"    
             verticalScrollPolicy="auto"
             horizontalScrollPolicy="off"
             >
             <mx:Repeater id="rp" dataProvider="{dataProvider}">
                 <mx:CheckBox id="rpCheckBox"
                      selected="{rp.currentItem.selected}"  
                     label="{rp.currentItem.label}"
                     data="{rp.currentItem.data}"                      
                 />
             </mx:Repeater>    
    </mx:VBox>

    <mx:HBox>
        <mx:Button label="OK"     click="recordSelections(false, false)" />
        <mx:Button label="Cancel" click="PopUpManager.removePopUp(this)" />
        <!-- "true" passed into recordSelections tells it that we're clearing -->
        <mx:Button label="Clear"  click="recordSelections(true, false)" />
        <mx:Button label="All"    click="recordSelections(false, true)" />      
    </mx:HBox>
</mx:TitleWindow>
